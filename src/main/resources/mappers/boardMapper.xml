<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.edu.board.mappers.boardMapper">

	<!-- <resultMap id="articlesResult" type="com.edu.board.dto.ArticleVO"> -->
	<resultMap id="articlesResult" type="boardDTO">
		<result property="id"				column="b_id"/>
		<result property="title"			column="title"/>
		<result property="content"		column="content"/>
		<result property="articleNO"			column="articleNO"/>
		<result property="writeDate"			column="writeDate"/>
		<result property="image"			column="image"/>
	</resultMap>

	<!-- 게시물 목록 : 계층상태로 추출하기 -->
	<select id="selectAllArticleList" resultMap="articlesResult">
		<![CDATA[
		SELECT	LEVEL, articleNO, parentNO, title, content, writeDate, imageFileName, id
		FROM		t_board
		START WITH parentNO = 0	
		CONNECT BY PRIOR articleNO = parentNO
		ORDER SIBLINGS BY articleNO DESC
		]]>
	</select>

	<!-- 새로운 게시글에 사용할 번호 추출하기 : 게시글 테이블에서 -->
	<select id="selectNewArticleNO" resultType="int">
		<![CDATA[
			SELECT	NVL(MAX(articleNO), 0) + 1
			FROM	t_board
		]]>
	</select>

	
	
	
	<!-- 전체 게시글 수 구하기 (Paging 처리) -->
	<select id="boardListTotalCount" parameterType="com.edu.board.dto.Criteria" resultType="Integer">
		<![CDATA[
		 	SELECT	COUNT(*)
		 	FROM	T_BOARD
		]]>
	</select>
	
	<!-- 게시글 목록 가져오기 (Paging) -->
	<!-- ROWNUM 을 가장 안 쪽에 사용하면 Mapper에서 인식을 못하기 때문에 바깥쪽에 사용하였다. -->
	<!-- rownum, level 이름으로 인해서 resultMap articlesResult 로 사용한다. -->
	<select id="boardListPaging" parameterType="com.edu.board.dto.Criteria" resultMap="articlesResult">
	<![CDATA[
	SELECT	*
	FROM	(
		SELECT  ROWNUM AS recNum, LVL, articleNO, parentNO, title, content, writeDate, imageFileName, id
		FROM
            (SELECT	LEVEL AS LVL, articleNO, parentNO, title, content, writeDate, imageFileName, id
            FROM		t_board
            START WITH parentNO = 0	
            CONNECT BY PRIOR articleNO = parentNO
            ORDER SIBLINGS BY articleNO DESC) )
	WHERE recNum BETWEEN (#{page} - 1) * #{perPageNum} + 1 AND #{page} * #{perPageNum}
	]]>
	</select>
	
</mapper>


