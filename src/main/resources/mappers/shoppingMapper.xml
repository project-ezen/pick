<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="shopping.mapper">
	<select id="cartList" parameterType="memberDTO" resultType="cartDTO">
		<![CDATA[
			SELECT *
			FROM cart
			WHERE m_id = #{m_id}
			AND cart_number = (SELECT MIN(cart_number) FROM cart WHERE m_id = '101')
		]]>
	</select>

	<select id="productList" parameterType="memberDTO" resultType="productDTO">
		<![CDATA[
			SELECT *
			FROM product
			WHERE product_id IN (SELECT product_id 
								 FROM cart 
								 WHERE m_id = #{m_id}
								 AND cart_number = (SELECT min(cart_number) FROM cart WHERE m_id = #{m_id}))
		]]>
	</select>
	
	<update id="changeCount" parameterType="cartDTO">
		<![CDATA[	
			UPDATE cart
			SET count = #{count}
			WHERE cart_id = #{cart_id}
		]]>
	</update>
	<!-- ============================================================================================================================================================================================= -->
	<select id="searchProductId" parameterType="String" resultType="int">
		<![CDATA[
			SELECT product_id
			FROM product
			WHERE product_name = #{product_name}
		]]>
	</select>
	
	<insert id="orderInsert" parameterType="orderDTO">
		<![CDATA[
			INSERT INTO product_order (order_id, m_id, product_id, order_number, receiver_name, receiver_phoneNum, zipcode, address, address_detail, order_status, count, final_price)
			VALUES (#{order_id}, #{m_id}, #{product_id}, #{order_number}, #{receiver_name}, #{receiver_phonenum}, #{zipcode}, #{address}, #{address_detail}, #{order_status}, #{count}, #{final_price})
		]]>
	</insert>
	
	<delete id="deleteProduct" parameterType="String">
		<![CDATA[
			DELETE FROM cart
			WHERE cart_id = #{cart_id}
		]]>
	</delete>
	
	<select id="checkOrderId" resultType="String">
		<![CDATA[
			SELECT order_id
			FROM product_order
		]]>
	</select>
	<select id="checkOrderNum" parameterType="String" resultType="String">
		<![CDATA[
			SELECT order_number
			FROM product_order
			WHERE m_id = #{m_id}
		]]>
	</select>
	<!-- ============================================================================================================================================================================================= -->
	<select id="orderInfo" parameterType="memberDTO" resultType="orderDTO">
		<![CDATA[
			SELECT * 
			FROM product_order
			WHERE m_id = #{m_id}
			ORDER BY order_date
		]]>
	</select>
	
	<select id="orderList" parameterType="orderDTO" resultType="productDTO">
		<![CDATA[
			SELECT * 
			FROM product
			WHERE product_id 
			IN (SELECT product_id FROM product_order WHERE order_id = #{order_id})
		]]>
	</select>
</mapper>