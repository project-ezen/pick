<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="shopping.mapper">
	<select id="cartList" parameterType="memberDTO" resultType="cartDTO">
		<![CDATA[
			SELECT cart_id, m_id FROM cart WHERE m_id = #{m_id}
		]]>
	</select>

	<select id="productsDetailList" parameterType="cartDTO" resultType="productDisplayVO">
		<![CDATA[
			SELECT d.product_display_id, d.product_name, d.product_info, d.capacity, d.alcohol_content, d.origin, d.manufacturer, d.product_image, d.product_price
			FROM cart c, product p, product_display d 
			WHERE p.cart_id = c.cart_id
			AND p.product_display_id = d.product_display_id
			AND c.cart_id = #{cart_id}
		]]>
	</select>
	
	<insert id="orderInsert" parameterType="orderDTO">
		<![CDATA[
			INSERT INTO product_order
			VALUES (#{order_id}, #{cart_id}, #{receiver_name}, #{receiver_phonenum}, #{zipcode}, #{address}, #{address_detail}, #{final_price})
		]]>
	</insert>
	
	<delete id="deleteProduct" parameterType="java.util.Map">
		<![CDATA[
			DELETE
			FROM (SELECT * 
			      FROM product
			      WHERE cart_id IN (SELECT cart_id FROM cart WHERE m_id = #{m_id}))
			WHERE product_display_id IN (SELECT product_display_id FROM product_display WHERE product_name = #{product_name})
		]]>
	</delete>
</mapper>