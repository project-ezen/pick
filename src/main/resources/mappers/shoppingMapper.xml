<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="shopping.mapper">
	<select id="cartList" parameterType="memberDTO" resultType="cartDTO">
		<![CDATA[
			SELECT *
			FROM cart
			WHERE m_id = #{m_id}
		]]>
	</select>

	<select id="productList" parameterType="memberDTO" resultType="productDTO">
		<![CDATA[
			SELECT *
			FROM product
			WHERE product_id IN 
							(SELECT product_id FROM cart WHERE m_id = #{m_id})
		]]>
	</select>
	
	<update id="changeCount" parameterType="cartDTO">
		<![CDATA[	
			UPDATE cart
			SET count = #{count}
			WHERE cart_id = #{cart_id}
		]]>
	</update>
	
	<insert id="orderInsert" parameterType="orderDTO">
		<![CDATA[
			INSERT INTO product_order (order_id, m_id, receiver_name, receiver_phoneNum, zipcode, address, address_detail, order_status, final_price)
			VALUES (#{order_id}, #{m_id}, #{receiver_name}, #{receiver_phonenum}, #{zipcode}, #{address}, #{address_detail}, #{order_status}, #{final_price})
		]]>
	</insert>
	
	<update id="updateProduct" parameterType="java.util.Map">
		<![CDATA[
			UPDATE
				(SELECT *
				FROM (SELECT * 
				      FROM product
				      WHERE cart_id IN (SELECT cart_id FROM cart WHERE m_id = #{member_id}))
				WHERE product_display_id 
				IN (SELECT product_display_id FROM product_display WHERE product_name = #{product_name}))
			SET order_id = #{order_id}, cart_id = null
		]]>
	</update>
	
	<select id="orderInfo" parameterType="memberDTO" resultType="orderDTO">
		<![CDATA[
			SELECT * 
			FROM product_order
			WHERE m_id = #{m_id}
		]]>
	</select>
	
	<select id="orderList" parameterType="orderDTO" resultType="productDTO">
		<![CDATA[
			SELECT * 
			FROM product
			WHERE order_id = #{order_id}
		]]>
	</select>
	
	<select id="orderListDetail" parameterType="orderDTO" resultType="productDisplayVO">
		<![CDATA[
			SELECT * 
			FROM product_display
			WHERE product_display_id = #{product_display_id}
		]]>
	</select>
</mapper>